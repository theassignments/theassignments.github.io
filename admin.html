 <!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard â€” TheAssignment</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f3f7fb;
  padding:20px;
}
.wrap{
  max-width:1100px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:10px;
}
.order{
  border:1px solid #ddd;
  padding:15px;
  border-radius:8px;
  margin-bottom:15px;
}
.btn{
  padding:6px 10px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  margin-right:5px;
  margin-top:6px;
  font-size:13px;
}
.received{background:#e0f2fe;}
.progress{background:#fef9c3;}
.completed{background:#dcfce7;}
.delivered{background:#e3e0ff;}
.logout{
  background:#ef4444;
  color:white;
  padding:8px 14px;
  border-radius:8px;
  border:none;
  cursor:pointer;
}
.small{font-size:13px;color:#555}
</style>
</head>

<body>

<div class="wrap">
  <h2>Admin Dashboard</h2>
  <p id="adminInfo"></p>
  <button class="logout" onclick="logout()">Logout</button>

  <h3>All Orders</h3>
  <div id="ordersList">Loading orders...</div>
</div>

<!-- Firebase v8 SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
/* ðŸ”¥ Firebase Init */
firebase.initializeApp({
  apiKey: "AIzaSyAwRT7JwLOXgpaA2qCfGKr2b6-yugEFryY",
  authDomain: "theassignments-2a79c.firebaseapp.com",
  projectId: "theassignments-2a79c"
});

const auth = firebase.auth();
const db = firebase.firestore();

const ADMIN_EMAIL = "theassignment.admin@gmail.com";

/* ðŸ” Admin Auth */
auth.onAuthStateChanged(user=>{
  if(!user){
    location.href="login-signup.html";
    return;
  }
  if(user.email !== ADMIN_EMAIL){
    alert("Access denied");
    location.href="submit.html";
    return;
  }
  adminInfo.innerText = "Logged in as: " + user.email;
  loadOrders();
});

function logout(){
  auth.signOut();
  location.href="login-signup.html";
}

/* ðŸ“¦ Load ALL Orders */
function loadOrders(){
  db.collection("orders")
    .orderBy("createdAt","desc")
    .onSnapshot(snapshot=>{
      ordersList.innerHTML="";

      if(snapshot.empty){
        ordersList.innerHTML="<p>No orders found</p>";
        return;
      }

      snapshot.forEach(doc=>{
        const o = doc.data();
        const div = document.createElement("div");
        div.className="order";

        /* user files */
        let userFiles="";
        if(o.files && o.files.length){
          userFiles = o.files.map(f =>
            `<a target="_blank" href="${f.url}">${f.name}</a>`
          ).join(", ");
        }

        /* final file */
        let finalFile = o.solutionFileURL
          ? `<div><b>Final File:</b>
               <a target="_blank" href="${o.solutionFileURL}">Download</a>
             </div>`
          : "";

        div.innerHTML = `
          <b>Title:</b> ${o.title}<br>
          <b>Subject:</b> ${o.subject}<br>
          <b>User:</b> ${o.userEmail}<br>

          <div><b>Pages:</b> ${o.pages || "-"}</div>
          <div><b>Deadline:</b> ${o.deadline || "-"}</div>

          <div class="small" style="margin-top:6px">
            <b>Instructions:</b><br>
            ${o.instructions || "-"}
          </div>

          <div><b>Delivery:</b> ${o.deliveryOpt || "digital"}</div>
          <div><b>Address:</b> ${o.deliveryAddr || "-"}</div>

          ${userFiles ? `
            <div style="margin-top:6px">
              <b>User Files:</b> ${userFiles}
            </div>` : ""}

          ${finalFile}

          <div style="margin-top:8px"><b>Status:</b> ${o.status}</div>

          <div style="margin-top:10px">
            <button class="btn received" onclick="updateStatus('${doc.id}','received')">Received</button>
            <button class="btn progress" onclick="updateStatus('${doc.id}','in_progress')">In Progress</button>
            <button class="btn completed" onclick="updateStatus('${doc.id}','completed')">Completed</button>
            <button class="btn delivered" onclick="updateStatus('${doc.id}','delivered')">Delivered</button>
          </div>
        `;

        ordersList.appendChild(div);
      });
    });
}

/* ðŸ”„ Update Order Status */
function updateStatus(id,status){
  db.collection("orders").doc(id).update({ status });
  alert("Status updated to " + status);
}
</script>

</body>
</html>
