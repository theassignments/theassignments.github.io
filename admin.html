<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard â€” TheAssignment</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f3f7fb;
  padding:20px;
}
.wrap{
  max-width:1000px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:10px;
}
.order{
  border:1px solid #ddd;
  padding:15px;
  border-radius:8px;
  margin-bottom:15px;
}
.btn{
  padding:6px 10px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  margin-right:5px;
  margin-top:5px;
}
.received{background:#e0f2fe;}
.progress{background:#fef9c3;}
.completed{background:#dcfce7;}
.delivered{background:#e3e0ff;}
.logout{
  background:#ef4444;
  color:white;
  padding:8px 14px;
  border-radius:8px;
  border:none;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="wrap">
  <h2>Admin Dashboard</h2>
  <p id="adminInfo"></p>
  <button class="logout" onclick="logout()">Logout</button>

  <h3>All Orders</h3>
  <div id="ordersList">Loading orders...</div>
</div>

<!-- Firebase v8 SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAwRT7JwLOXgpaA2qCfGKr2b6-yugEFryY",
  authDomain: "theassignments-2a79c.firebaseapp.com",
  projectId: "theassignments-2a79c"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

const ADMIN_EMAIL = "theassignment.admin@gmail.com";

/* ðŸ” Admin Auth Check */
auth.onAuthStateChanged(user=>{
  if(!user){
    location.href="login-signup.html";
    return;
  }
  if(user.email !== ADMIN_EMAIL){
    alert("Access denied");
    location.href="submit.html";
    return;
  }
  document.getElementById("adminInfo").innerText =
    "Logged in as: " + user.email;
  loadOrders();
});

function logout(){
  auth.signOut();
  location.href="login-signup.html";
}

/* ðŸ“¦ Load Orders */
function loadOrders(){
  db.collection("orders").onSnapshot(snapshot=>{
    const list=document.getElementById("ordersList");
    list.innerHTML="";

    if(snapshot.empty){
      list.innerHTML="<p>No orders found</p>";
      return;
    }

    snapshot.forEach(doc=>{
      const o=doc.data();
      const div=document.createElement("div");
      div.className="order";

      div.innerHTML=`
        <b>Title:</b> ${o.title}<br>
        <b>Subject:</b> ${o.subject}<br>
        <b>User:</b> ${o.userEmail}<br>
        <b>Delivery:</b> ${o.delivery}<br>
        <b>Status:</b> ${o.status}<br><br>

        <button class="btn received" onclick="updateStatus('${doc.id}','received')">Received</button>
        <button class="btn progress" onclick="updateStatus('${doc.id}','in_progress')">In Progress</button>
        <button class="btn completed" onclick="updateStatus('${doc.id}','completed')">Completed</button>
        <button class="btn delivered" onclick="updateStatus('${doc.id}','delivered')">Delivered</button>
      `;
      list.appendChild(div);
    });
  });
}

/* ðŸ”„ Update Status */
function updateStatus(id,status){
  db.collection("orders").doc(id).update({status});
  alert("Status updated to " + status);
}
</script>

</body>
</html>
