<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Submit Assignment â€” TheAssignment</title>

<style>
body{margin:0;font-family:Inter,Arial;background:#f5f7fb;padding:18px}
.wrap{max-width:1000px;margin:auto;background:#fff;padding:18px;border-radius:12px}
form{display:grid;gap:10px}
input,textarea,select{padding:10px;border-radius:8px;border:1px solid #e6eef8}
.row{display:flex;gap:10px}
.col{flex:1}
.btn{background:#2b8aef;color:#fff;padding:10px;border:none;border-radius:8px;cursor:pointer}
.order{border:1px solid #eef2f8;padding:10px;border-radius:8px;margin-bottom:10px}
.small{font-size:13px;color:#6b7280}
</style>
</head>

<body>
<div class="wrap">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h2>Submit Your Assignment</h2>
    <div>
      <span id="userInfo" class="small"></span>
      <button id="btnSignOut" class="btn" style="display:none" onclick="signOut()">Sign out</button>
    </div>
  </div>

  <form id="submitForm" onsubmit="submitOrder(event)">
    <input id="title" placeholder="Assignment title" required />
    <div class="row">
      <div class="col">
        <select id="subject" required>
          <option value="">Select Subject</option>
          <option>Economics</option>
          <option>Computer Science</option>
          <option>Business</option>
        </select>
      </div>
      <div class="col">
        <input id="pages" type="number" placeholder="Pages" />
      </div>
    </div>

    <textarea id="instructions" rows="4" placeholder="Instructions"></textarea>

    <select id="deliveryOpt">
      <option value="digital">Digital Only</option>
      <option value="home">Home Delivery</option>
    </select>

    <button class="btn" type="submit">Submit Assignment</button>
  </form>

  <h3>Your Orders</h3>
  <div id="ordersList">Loading...</div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyAwRT7JwLOXgpaA2qCfGKr2b6-yugEFryY",
  authDomain: "theassignments-2a79c.firebaseapp.com",
  projectId: "theassignments-2a79c"
});

const auth = firebase.auth();
const db = firebase.firestore();

auth.onAuthStateChanged(user=>{
  if(!user) return location.href="login-signup.html";
  document.getElementById("userInfo").innerText = user.email;
  document.getElementById("btnSignOut").style.display="inline-block";
  loadOrders(user.uid);
});

function signOut(){
  auth.signOut();
  location.href="login-signup.html";
}

async function submitOrder(e){
  e.preventDefault();
  const user = auth.currentUser;

  await db.collection("orders").add({
    userId: user.uid,
    userEmail: user.email,
    title: title.value,
    subject: subject.value,
    pages: pages.value || null,
    deliveryOpt: deliveryOpt.value,
    status: "received",
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });

  submitForm.reset();
  alert("Order submitted successfully!");
}

function loadOrders(uid){
  db.collection("orders")
    .where("userId","==",uid)
    .orderBy("createdAt","desc")
    .onSnapshot(snap=>{
      const list = document.getElementById("ordersList");
      list.innerHTML = "";

      if(snap.empty){
        list.innerHTML = "<p class='small'>No orders yet</p>";
        return;
      }

      snap.forEach(doc=>{
        const o = doc.data();
        list.innerHTML += `
          <div class="order">
            <strong>${o.title}</strong><br>
            Subject: ${o.subject}<br>
            Status: ${o.status}
          </div>
        `;
      });
    }, err=>{
      document.getElementById("ordersList").innerHTML =
        "<p class='small'>Loading failed. Please refresh.</p>";
      console.error(err);
    });
}
</script>
</body>
</html>
